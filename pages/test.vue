<template>  <view class="container">    <view class="header">      <text class="title">å•†å“ä¸Šä¼ </text>      <text class="subtitle">è¯·æŒ‰ç…§æ­¥éª¤å¡«å†™å•†å“ä¿¡æ¯ï¼Œç¡®ä¿ä¿¡æ¯å‡†ç¡®å®Œæ•´</text>    </view>        <view class="upload-container">      <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->      <view class="steps">        <view           class="step"           :class="{ active: currentStep === 1 }"        >          <text class="step-number">1</text>          <text class="step-text">é€‰æ‹©ç±»åˆ«</text>        </view>        <view           class="step"           :class="{ active: currentStep === 2 }"        >          <text class="step-number">2</text>          <text class="step-text">åŸºæœ¬ä¿¡æ¯</text>        </view>        <view           class="step"           :class="{ active: currentStep === 3 }"        >          <text class="step-number">3</text>          <text class="step-text">è§„æ ¼åº“å­˜</text>        </view>      </view>            <!-- æ­¥éª¤å†…å®¹ -->      <scroll-view class="step-content" scroll-y>        <!-- æ­¥éª¤1: é€‰æ‹©ç±»åˆ« -->        <view v-if="currentStep === 1" class="step-panel">          <view class="form-group">            <text class="form-label">å•†å“åˆ†ç±»</text>                        <!-- ä¸€çº§åˆ†ç±» -->            <view class="picker-group">              <text class="picker-label">ä¸€çº§åˆ†ç±»</text>              <picker                 @change="onCategory1Change"                 :value="category1Index"                 :range="category1Options"                range-key="name"                class="picker"              >                <view class="picker-text">                  {{ category1Options[category1Index] ? category1Options[category1Index].name : 'è¯·é€‰æ‹©ä¸€çº§åˆ†ç±»' }}                  <text v-if="loadingCategory1" class="loading-indicator">åŠ è½½ä¸­...</text>                </view>              </picker>            </view>                        <!-- äºŒçº§åˆ†ç±» -->            <view class="picker-group">              <text class="picker-label">äºŒçº§åˆ†ç±»</text>              <picker                 @change="onCategory2Change"                 :value="category2Index"                 :range="category2Options"                range-key="name"                :disabled="!selectedCategory1Id || loadingCategory2"                class="picker"              >                <view class="picker-text" :class="{                   disabled: !selectedCategory1Id,                  loading: loadingCategory2                 }">                  <template v-if="loadingCategory2">                    åŠ è½½ä¸­...                  </template>                  <template v-else-if="!selectedCategory1Id">                    è¯·å…ˆé€‰æ‹©ä¸€çº§åˆ†ç±»                  </template>                  <template v-else>                    {{ category2Options[category2Index] ? category2Options[category2Index].name : 'è¯·é€‰æ‹©äºŒçº§åˆ†ç±»' }}                  </template>                </view>              </picker>            </view>                        <!-- ä¸‰çº§åˆ†ç±» -->            <view class="picker-group">              <text class="picker-label">ä¸‰çº§åˆ†ç±»</text>              <picker                 @change="onCategory3Change"                 :value="category3Index"                 :range="category3Options"                range-key="name"                :disabled="!selectedCategory2Id || loadingCategory3"                class="picker"              >                <view class="picker-text" :class="{                   disabled: !selectedCategory2Id,                  loading: loadingCategory3                 }">                  <template v-if="loadingCategory3">                    åŠ è½½ä¸­...                  </template>                  <template v-else-if="!selectedCategory2Id">                    è¯·å…ˆé€‰æ‹©äºŒçº§åˆ†ç±»                  </template>                  <template v-else>                    {{ category3Options[category3Index] ? category3Options[category3Index].name : 'è¯·é€‰æ‹©ä¸‰çº§åˆ†ç±»' }}                  </template>                </view>              </picker>            </view>                        <!-- åˆ†ç±»é€‰æ‹©çŠ¶æ€æ˜¾ç¤º -->            <view class="category-status" v-if="selectedCategory3Id">              <text class="status-text">å·²é€‰æ‹©åˆ†ç±»ï¼š</text>              <text class="category-path">{{ selectedCategoryPath }}</text>            </view>            <!-- é”™è¯¯ä¿¡æ¯æ˜¾ç¤º -->            <view v-if="categoryError" class="error-message">              <text>{{ categoryError }}</text>              <text class="retry-text" @tap="loadLevel1Categories">ç‚¹å‡»é‡è¯•</text>            </view>          </view>                    <view class="action-buttons">            <view></view>            <button class="btn btn-primary" @tap="goToStep(2)" :disabled="!selectedCategory3Id">              {{ selectedCategory3Id ? 'ä¸‹ä¸€æ­¥' : 'è¯·å…ˆé€‰æ‹©å®Œæ•´åˆ†ç±»' }}            </button>          </view>        </view>                <!-- æ­¥éª¤2: åŸºæœ¬ä¿¡æ¯ -->        <view v-if="currentStep === 2" class="step-panel">          <view class="form-group">            <text class="form-label">å•†å“è½®æ’­å›¾</text>            <view class="upload-area" @tap="chooseImages" :class="{ 'drag-over': isDragOver }"                   @touchmove.prevent @touchend="isDragOver = false" @touchstart="isDragOver = true">              <text class="upload-icon">ğŸ“·</text>              <text class="upload-text">ç‚¹å‡»ä¸Šä¼ å•†å“å›¾ç‰‡</text>              <text class="upload-tip">å»ºè®®å°ºå¯¸ï¼š800x800åƒç´ ï¼Œæœ€å¤š10å¼ </text>            </view>                        <!-- ä¸Šä¼ çŠ¶æ€æç¤º -->            <view class="upload-status" v-if="uploading">              <text class="upload-status-text">å›¾ç‰‡ä¸Šä¼ ä¸­... {{ uploadProgress }}%</text>            </view>                        <view class="upload-tips">              <text class="tip-text">â€¢ æ”¯æŒ JPGã€PNG æ ¼å¼</text>              <text class="tip-text">â€¢ å•å¼ å›¾ç‰‡ä¸è¶…è¿‡ 5MB</text>              <text class="tip-text">â€¢ å»ºè®®å°ºå¯¸ï¼š800x800 åƒç´ </text>            </view>                        <view class="image-preview">              <view                 v-for="(image, index) in productImages"                 :key="index"                 class="preview-item"              >                <image :src="image.url" class="preview-image" mode="aspectFill"></image>                <view class="remove" @tap="removeImage(index)">Ã—</view>                <view class="upload-success" v-if="image.uploaded">                  <text class="success-icon">âœ“</text>                </view>              </view>              <view v-if="productImages.length === 0" class="empty-preview">                <text class="empty-text">æš‚æ— å›¾ç‰‡ï¼Œè¯·ä¸Šä¼ å•†å“è½®æ’­å›¾</text>              </view>            </view>          </view>                    <view class="form-group">            <text class="form-label">å•†å“æ ‡é¢˜</text>            <uni-easyinput              v-model="productData.productName"              placeholder="è¯·è¾“å…¥å•†å“æ ‡é¢˜"              :styles="inputStyles"            />          </view>                    <view class="form-group">            <text class="form-label">å•†å“æè¿°</text>            <view class="description-container">              <uni-easyinput                v-model="productData.productDetail"                type="textarea"                placeholder="è¯·è¾“å…¥å•†å“çš„è¯¦ç»†æè¿°ï¼ŒåŒ…æ‹¬äº§å“ç‰¹ç‚¹ã€æè´¨ã€ç”¨é€”ç­‰ä¿¡æ¯"                :styles="textareaStyles"              />            </view>          </view>                    <view class="action-buttons">            <button class="btn btn-secondary" @tap="goToStep(1)">ä¸Šä¸€æ­¥</button>            <button class="btn btn-primary" @tap="goToStep(3)" :disabled="productImages.length === 0">              {{ productImages.length > 0 ? 'ä¸‹ä¸€æ­¥' : 'è¯·å…ˆä¸Šä¼ å•†å“å›¾ç‰‡' }}            </button>          </view>        </view>                <!-- æ­¥éª¤3: è§„æ ¼ä¸åº“å­˜ -->        <view v-if="currentStep === 3" class="step-panel">          <view class="form-group">            <text class="form-label">å•†å“è§„æ ¼</text>            <view class="specifications-container">              <view                 v-for="(spec, index) in specifications"                 :key="spec.id"                 class="specification-container"              >                <view class="spec-header">                  <view class="spec-name-input">                    <uni-easyinput                      v-model="spec.name"                      placeholder="è¯·è¾“å…¥è§„æ ¼åç§°ï¼Œå¦‚ï¼šé¢œè‰²ã€å°ºå¯¸ç­‰"                      :styles="specNameInputStyles"                      :clearable="true"                      @blur="updateSpecName(spec.id, spec.name)"                    />                  </view>                  <text class="delete-spec" @tap="removeSpecification(spec.id)">åˆ é™¤</text>                </view>                <view class="spec-body">                  <view class="spec-values">                    <view                       v-for="value in spec.values"                       :key="value"                       class="spec-value-item"                    >                      <text>{{ value }}</text>                      <text class="remove-value" @tap="removeSpecValue(spec.id, value)">Ã—</text>                    </view>                  </view>                  <!-- ä¿®æ”¹åçš„è§„æ ¼å€¼æ·»åŠ åŒºåŸŸ -->                  <view class="add-value-container">                    <view class="add-value-input-wrapper">                      <uni-easyinput                        v-model="spec.newValue"                        placeholder="è¾“å…¥è§„æ ¼å€¼"                        :styles="specValueInputStyles"                        :clearable="true"                        @confirm="addSpecValue(spec.id)"                      />                    </view>                    <button class="btn btn-mini add-value-btn" @tap="addSpecValue(spec.id)">æ·»åŠ </button>                  </view>                </view>              </view>            </view>                        <view class="add-spec-btn" @tap="addSpecification" v-if="specifications.length < 2">              <text class="add-icon">+</text>              <text>æ·»åŠ è§„æ ¼ç±»å‹</text>              <text class="spec-count">({{ specifications.length }}/2)</text>            </view>          </view>                    <view class="form-group">            <text class="form-label">ä»·æ ¼åŠåº“å­˜</text>            <text class="warning-text">è¯·å¦‚å®å¡«å†™åº“å­˜ä¿¡æ¯ï¼Œä»¥ç¡®ä¿å•†å“å¯ä»¥åœ¨æ‰¿è¯ºå‘è´§æ—¶é—´å†…å‘å‡ºï¼Œé¿å…ç‰©æµè¿è§„</text>                        <!-- ä»·æ ¼åº“å­˜è¡¨æ ¼ -->            <view class="price-stock-container">              <view class="table">                <view class="table-header">                  <view class="table-row">                    <view                       v-for="spec in specifications"                       :key="spec.id"                       class="table-header-cell"                    >                      {{ spec.name || 'è§„æ ¼' }}                    </view>                    <view class="table-header-cell required-field">åº“å­˜</view>                    <view class="table-header-cell required-field">å•ä»·(å…ƒ)</view>                    <view class="table-header-cell">çŠ¶æ€</view>                  </view>                </view>                                <view class="table-body">                  <view                     v-for="(item, index) in priceStockData"                     :key="index"                     class="table-row"                  >                    <view                       v-for="(value, valueIndex) in item.values"                       :key="valueIndex"                       class="table-cell"                    >                      {{ value }}                    </view>                    <view class="table-cell">                      <uni-easyinput                        v-model="item.stock"                        placeholder="åº“å­˜"                        type="number"                        :styles="tableInputStyles"                        :clearable="false"                      />                    </view>                    <view class="table-cell">                      <uni-easyinput                        v-model="item.singlePrice"                        placeholder="ä»·æ ¼"                        type="number"                        :styles="tableInputStyles"                        :clearable="false"                      />                    </view>                    <view class="table-cell">                      <text                         class="status-badge"                         :class="{ 'status-off': item.status === 'off' }"                        @tap="toggleStatus(index)"                      >                        {{ item.status === 'on' ? 'ä¸Šæ¶' : 'ä¸‹æ¶' }}                      </text>                    </view>                  </view>                </view>              </view>                            <!-- æ‰¹é‡è®¾ç½® -->              <view class="batch-setting" v-if="specifications.length > 0">                <text class="batch-label">æ‰¹é‡è®¾ç½®ï¼š</text>                <view class="batch-inputs">                  <uni-easyinput                    v-model="batchStock"                    placeholder="åº“å­˜"                    type="number"                    :styles="batchInputStyles"                    :clearable="false"                  />                  <uni-easyinput                    v-model="batchSinglePrice"                    placeholder="ä»·æ ¼"                    type="number"                    :styles="batchInputStyles"                    :clearable="false"                  />                  <button class="btn btn-mini batch-btn" @tap="batchSetValues">åº”ç”¨</button>                </view>              </view>            </view>          </view>                    <view class="price-section">            <view class="price-header">              <text class="price-title">å•†å“å‚è€ƒä»·</text>              <text class="price-tip">åº”å¤§äºå•†å“æœ€å¤§å•ä¹°ä»·</text>            </view>            <view class="reference-price">              <uni-easyinput                v-model="referencePrice"                placeholder="0.00"                type="number"                :styles="priceInputStyles"                :clearable="false"              />              <text class="price-unit">å…ƒ</text>            </view>          </view>                    <view class="action-buttons">            <button class="btn btn-secondary" @tap="goToStep(2)">ä¸Šä¸€æ­¥</button>            <button class="btn btn-success" :disabled="loading" @tap="submitProduct">              {{ loading ? 'æäº¤ä¸­...' : 'æäº¤å•†å“' }}            </button>          </view>        </view>      </scroll-view>    </view>  </view></template><script>// å¯¼å…¥APIå‡½æ•°import {   getLevel1Categories,   getLevel2CategoriesByLevel1,   getLevel3CategoriesByLevel2,  addProductSpu,   addProductSku} from '@/api/product.js'// å¯¼å…¥å›¾ç‰‡ä¸Šä¼ ç›¸å…³API - ä½¿ç”¨ä¸è®¾è®¡å¸ˆå…¥é©»ç›¸åŒçš„APIimport { uploadImage, deleteImage } from '@/api/join.js'export default {  data() {    return {      currentStep: 1,            // åˆ†ç±»æ•°æ®      category1Index: 0,      category2Index: 0,      category3Index: 0,      category1Options: [],      category2Options: [],      category3Options: [],            // åˆ†ç±»åŠ è½½çŠ¶æ€      loadingCategory1: false,      loadingCategory2: false,      loadingCategory3: false,      categoryError: '',            // å­˜å‚¨é€‰ä¸­çš„åˆ†ç±»ä¿¡æ¯      selectedCategory1Id: null,      selectedCategory2Id: null,      selectedCategory3Id: null,      selectedCategory1Name: '',      selectedCategory2Name: '',      selectedCategory3Name: '',      selectedCategoryPath: '',            // å•†å“å›¾ç‰‡ - ä½¿ç”¨ä¸è®¾è®¡å¸ˆå…¥é©»ç›¸åŒçš„ç»“æ„      productImages: [], // { url: '', uploaded: boolean, mediaId: null, fileInfo: {} }      uploading: false,      uploadProgress: 0,      isDragOver: false,            // å•†å“æ•°æ®      productData: {        productName: '',        productDetail: '',        categoryId: null,        productStatus: '0',        specType: '0',        marketPrice: 0,        costPrice: 0,        stock: 100      },            // è§„æ ¼æ•°æ®      specifications: [],      specCounter: 1,            // ä»·æ ¼åº“å­˜æ•°æ®      priceStockData: [],            // æ‰¹é‡è®¾ç½®      batchStock: '',      batchSinglePrice: '',            // å‚è€ƒä»·      referencePrice: '',            // åŠ è½½çŠ¶æ€      loading: false,            // uni-easyinput æ ·å¼é…ç½®      inputStyles: {        borderColor: '#e0e0e0',        color: '#333',        backgroundColor: '#fff'      },      textareaStyles: {        borderColor: '#e0e0e0',        color: '#333',        backgroundColor: '#fff',        minHeight: '200rpx'      },      // ä¿®æ”¹åçš„è§„æ ¼è¾“å…¥æ¡†æ ·å¼      specNameInputStyles: {        borderColor: '#e0e0e0',        color: '#333',        backgroundColor: '#fff'      },      specValueInputStyles: {        borderColor: '#e0e0e0',        color: '#333',        backgroundColor: '#fff'      },      tableInputStyles: {        borderColor: 'transparent',        color: '#333',        backgroundColor: 'transparent',        textAlign: 'center'      },      batchInputStyles: {        borderColor: '#e0e0e0',        color: '#333',        backgroundColor: '#fff'      },      priceInputStyles: {        borderColor: '#e0e0e0',        color: '#333',        backgroundColor: '#fff'      }    }  },    methods: {    // æ­¥éª¤åˆ‡æ¢    goToStep(step) {      if (step === 2 && !this.selectedCategory3Id) {        uni.showToast({          title: 'è¯·å…ˆé€‰æ‹©å®Œæ•´çš„ä¸‰çº§åˆ†ç±»',          icon: 'none'        })        return      }      this.currentStep = step      if (step === 3) {        this.generatePriceStockTable()      }    },        // ä¸€çº§åˆ†ç±»é€‰æ‹©    async onCategory1Change(e) {      const index = parseInt(e.detail.value)      this.category1Index = index      const selectedCategory = this.category1Options[index]            if (selectedCategory) {        this.selectedCategory1Id = selectedCategory.id        this.selectedCategory1Name = selectedCategory.name                console.log('é€‰æ‹©ä¸€çº§åˆ†ç±»:', {          åç§°: selectedCategory.name,          ID: this.selectedCategory1Id        })                // é‡ç½®ä¸‹çº§åˆ†ç±»        this.category2Options = []        this.category3Options = []        this.category2Index = 0        this.category3Index = 0        this.selectedCategory2Id = null        this.selectedCategory2Name = ''        this.selectedCategory3Id = null        this.selectedCategory3Name = ''                this.updateCategoryPath()                // åŠ è½½äºŒçº§åˆ†ç±»        await this.loadLevel2Categories(this.selectedCategory1Id)              }    },        // äºŒçº§åˆ†ç±»é€‰æ‹©    async onCategory2Change(e) {      const index = parseInt(e.detail.value)      this.category2Index = index      const selectedCategory = this.category2Options[index]            if (selectedCategory) {        this.selectedCategory2Id = selectedCategory.id        this.selectedCategory2Name = selectedCategory.name                console.log('é€‰æ‹©äºŒçº§åˆ†ç±»:', {          åç§°: selectedCategory.name,          ID: this.selectedCategory2Id        })                // é‡ç½®ä¸‰çº§åˆ†ç±»        this.category3Options = []        this.category3Index = 0        this.selectedCategory3Id = null        this.selectedCategory3Name = ''                this.updateCategoryPath()                // åŠ è½½ä¸‰çº§åˆ†ç±»        await this.loadLevel3Categories(this.selectedCategory2Id)      }    },        // ä¸‰çº§åˆ†ç±»é€‰æ‹©    onCategory3Change(e) {      const index = parseInt(e.detail.value)      this.category3Index = index      const selectedCategory = this.category3Options[index]            if (selectedCategory) {        this.selectedCategory3Id = selectedCategory.id        this.selectedCategory3Name = selectedCategory.name        this.productData.categoryId = this.selectedCategory3Id                this.updateCategoryPath()                uni.showToast({          title: 'åˆ†ç±»é€‰æ‹©å®Œæˆ',          icon: 'success',          duration: 1500        })                console.log('ä¸‰çº§åˆ†ç±»é€‰æ‹©:', {          é€‰æ‹©çš„ä¸‰çº§åˆ†ç±»: selectedCategory.name,          åˆ†ç±»ID: this.selectedCategory3Id        })      }    },        // æ›´æ–°åˆ†ç±»è·¯å¾„æ˜¾ç¤º    updateCategoryPath() {      let path = ''      if (this.selectedCategory1Name) path += this.selectedCategory1Name      if (this.selectedCategory2Name) path += ' / ' + this.selectedCategory2Name      if (this.selectedCategory3Name) path += ' / ' + this.selectedCategory3Name            this.selectedCategoryPath = path    },        // åŠ è½½ä¸€çº§åˆ†ç±»    async loadLevel1Categories() {      try {        this.loadingCategory1 = true        this.categoryError = ''                uni.showLoading({          title: 'åŠ è½½åˆ†ç±»ä¸­...',          mask: true        })                const response = await getLevel1Categories()        console.log('ä¸€çº§åˆ†ç±»APIå“åº”:', response)                if (response.code === 200) {          const categoryData = response.data                    if (!categoryData || categoryData.length === 0) {            throw new Error('ä¸€çº§åˆ†ç±»æ•°æ®ä¸ºç©º')          }                    this.category1Options = categoryData                    console.log('ä¸€çº§åˆ†ç±»åŠ è½½æˆåŠŸ:', {            'ä¸€çº§åˆ†ç±»æ•°é‡': this.category1Options.length,            'ä¸€çº§åˆ†ç±»åˆ—è¡¨': this.category1Options.map(cat => ({              name: cat.name,              id: cat.id            }))          })                    uni.showToast({            title: 'åˆ†ç±»åŠ è½½æˆåŠŸ',            icon: 'success',            duration: 1500          })                  } else {          throw new Error(response.message || 'åŠ è½½ä¸€çº§åˆ†ç±»å¤±è´¥')        }              } catch (error) {        console.error('åŠ è½½ä¸€çº§åˆ†ç±»å¤±è´¥:', error)        this.categoryError = error.message || 'ä¸€çº§åˆ†ç±»åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'        uni.showToast({          title: 'åˆ†ç±»åŠ è½½å¤±è´¥',          icon: 'none',          duration: 3000        })                this.category1Options = []      } finally {        this.loadingCategory1 = false        uni.hideLoading()      }    },        // åŠ è½½äºŒçº§åˆ†ç±» - æ ¹æ®ä¸€çº§åˆ†ç±»ID    async loadLevel2Categories(level1CategoryId) {      try {        this.loadingCategory2 = true                console.log('å¼€å§‹åŠ è½½äºŒçº§åˆ†ç±»ï¼Œä¸€çº§åˆ†ç±»ID:', level1CategoryId)                const response = await getLevel2CategoriesByLevel1(level1CategoryId)        console.log('äºŒçº§åˆ†ç±»APIå“åº”:', response)                if (response.code === 200) {          const categoryData = response.data                    this.category2Options = categoryData                    console.log('äºŒçº§åˆ†ç±»åŠ è½½æˆåŠŸ:', {            'äºŒçº§åˆ†ç±»æ•°é‡': this.category2Options.length,            'äºŒçº§åˆ†ç±»åˆ—è¡¨': this.category2Options.map(cat => ({              name: cat.name,              id: cat.id            }))          })                    if (this.category2Options.length === 0) {            uni.showToast({              title: 'è¯¥åˆ†ç±»ä¸‹æš‚æ— äºŒçº§åˆ†ç±»',              icon: 'none',              duration: 2000            })          }                  } else {          throw new Error(response.message || 'åŠ è½½äºŒçº§åˆ†ç±»å¤±è´¥')        }              } catch (error) {        console.error('åŠ è½½äºŒçº§åˆ†ç±»å¤±è´¥:', error)        uni.showToast({          title: 'äºŒçº§åˆ†ç±»åŠ è½½å¤±è´¥',          icon: 'none',          duration: 2000        })                this.category2Options = []      } finally {        this.loadingCategory2 = false      }    },        // åŠ è½½ä¸‰çº§åˆ†ç±» - æ ¹æ®äºŒçº§åˆ†ç±»ID    async loadLevel3Categories(level2CategoryId) {      try {        this.loadingCategory3 = true                console.log('å¼€å§‹åŠ è½½ä¸‰çº§åˆ†ç±»ï¼ŒäºŒçº§åˆ†ç±»ID:', level2CategoryId)                const response = await getLevel3CategoriesByLevel2(level2CategoryId)        console.log('ä¸‰çº§åˆ†ç±»APIå“åº”:', response)                if (response.code === 200) {          const categoryData = response.data                    this.category3Options = categoryData                    console.log('ä¸‰çº§åˆ†ç±»åŠ è½½æˆåŠŸ:', {            'ä¸‰çº§åˆ†ç±»æ•°é‡': this.category3Options.length,            'ä¸‰çº§åˆ†ç±»åˆ—è¡¨': this.category3Options.map(cat => ({              name: cat.name,              id: cat.id            }))          })                    if (this.category3Options.length === 0) {            uni.showToast({              title: 'è¯¥åˆ†ç±»ä¸‹æš‚æ— ä¸‰çº§åˆ†ç±»',              icon: 'none',              duration: 2000            })          }                  } else {          throw new Error(response.message || 'åŠ è½½ä¸‰çº§åˆ†ç±»å¤±è´¥')        }              } catch (error) {        console.error('åŠ è½½ä¸‰çº§åˆ†ç±»å¤±è´¥:', error)        uni.showToast({          title: 'ä¸‰çº§åˆ†ç±»åŠ è½½å¤±è´¥',          icon: 'none',          duration: 2000        })                this.category3Options = []      } finally {        this.loadingCategory3 = false      }    },        // å›¾ç‰‡ä¸Šä¼  - ä¿®å¤åçš„ç‰ˆæœ¬    async chooseImages() {      if (this.productImages.length >= 10) {        uni.showToast({          title: 'æœ€å¤šåªèƒ½ä¸Šä¼ 10å¼ å›¾ç‰‡',          icon: 'none'        })        return      }      try {        uni.showLoading({          title: 'é€‰æ‹©å›¾ç‰‡ä¸­...',          mask: true        })        // ä½¿ç”¨ Promise åŒ…è£… uni.chooseImage        const res = await new Promise((resolve, reject) => {          uni.chooseImage({            count: 10 - this.productImages.length,            sizeType: ['compressed'],            sourceType: ['album', 'camera'],            success: resolve,            fail: reject          })        })        uni.hideLoading()        console.log('chooseImage è¿”å›ç»“æœ:', res)        // å¤„ç†ä¸åŒçš„è¿”å›ç»“æ„        let tempFilePaths = []        if (res.tempFilePaths && Array.isArray(res.tempFilePaths)) {          tempFilePaths = res.tempFilePaths        } else if (res.tempFiles && Array.isArray(res.tempFiles)) {          tempFilePaths = res.tempFiles.map(file => file.path || file.tempFilePath || file.url)        } else if (res.errMsg === 'chooseImage:ok' && res.tempFiles) {          tempFilePaths = res.tempFiles.map(file => file.path || file.tempFilePath || file.url)        }        if (tempFilePaths.length === 0) {          throw new Error('æœªé€‰æ‹©åˆ°æœ‰æ•ˆå›¾ç‰‡')        }        console.log('æå–åˆ°çš„å›¾ç‰‡è·¯å¾„:', tempFilePaths)        // å¼€å§‹ä¸Šä¼         await this.uploadSelectedImages(tempFilePaths)      } catch (error) {        uni.hideLoading()        console.error('å›¾ç‰‡é€‰æ‹©å¤±è´¥:', error)                let errorMessage = 'å›¾ç‰‡é€‰æ‹©å¤±è´¥'        if (error.errMsg) {          if (error.errMsg.includes('cancel')) {            errorMessage = 'å·²å–æ¶ˆé€‰æ‹©'          } else {            errorMessage = error.errMsg          }        } else if (error.message) {          errorMessage = error.message        }                uni.showToast({          title: errorMessage,          icon: 'none',          duration: 2000        })      }    },    // ä¸Šä¼ é€‰ä¸­å›¾ç‰‡çš„æ–¹æ³•    async uploadSelectedImages(tempFilePaths) {      this.uploading = true      this.uploadProgress = 0      uni.showLoading({        title: 'ä¸Šä¼ ä¸­...',        mask: true      })      const uploadPromises = tempFilePaths.map(async (filePath, index) => {        try {          const result = await this.uploadProductImage(filePath, this.productImages.length + index)          // æ·»åŠ åˆ°å›¾ç‰‡åˆ—è¡¨          this.productImages.push({            url: result.fileUrl,            uploaded: true,            fileInfo: result,            mediaId: result.mediaId          })          // æ›´æ–°è¿›åº¦          this.uploadProgress = Math.round(((index + 1) / tempFilePaths.length) * 100)          return {            success: true,            url: result.fileUrl,            fileInfo: result,            index: index          }        } catch (error) {          console.error(`ç¬¬${index + 1}å¼ å›¾ç‰‡ä¸Šä¼ å¤±è´¥:`, error)          return {            success: false,            error: error.message,            index: index          }        }      })      try {        const results = await Promise.all(uploadPromises)        // å¤„ç†ä¸Šä¼ ç»“æœ        const successResults = results.filter(result => result.success)        const failedResults = results.filter(result => !result.success)        uni.hideLoading()        this.uploading = false        // æ˜¾ç¤ºä¸Šä¼ ç»“æœ        if (successResults.length > 0) {          uni.showToast({            title: `ä¸Šä¼ æˆåŠŸ ${successResults.length} å¼ `,            icon: 'success',            duration: 2000          })        }        if (failedResults.length > 0) {          console.warn('éƒ¨åˆ†å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', failedResults)          if (successResults.length === 0) {            uni.showToast({              title: 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥',              icon: 'none',              duration: 3000            })          } else {            uni.showToast({              title: `${successResults.length}å¼ æˆåŠŸï¼Œ${failedResults.length}å¼ å¤±è´¥`,              icon: 'none',              duration: 3000            })          }        }      } catch (error) {        uni.hideLoading()        this.uploading = false        console.error('ä¸Šä¼ è¿‡ç¨‹å‡ºé”™:', error)        uni.showToast({          title: 'ä¸Šä¼ å¤±è´¥',          icon: 'none',          duration: 3000        })      }    },    // ä¸Šä¼ å•å¼ å•†å“å›¾ç‰‡ - ä½¿ç”¨ä¸è®¾è®¡å¸ˆå…¥é©»ç›¸åŒçš„ä¸Šä¼ é€»è¾‘    async uploadProductImage(filePath, sequence = 0) {      try {        console.log('ğŸ”„ Starting product image upload process, sequence:', sequence)                // ä½¿ç”¨å•†å“ç›¸å…³çš„å…³è”ç±»å‹ï¼Œä½†ä½¿ç”¨ç›¸åŒçš„ä¸Šä¼ API        const relatedType = 4 // PRODUCT - å•†å“ç±»å‹        const relatedId = 0 // æš‚æ—¶ä¸º0ï¼Œåˆ›å»ºSPUåä¼šæ›´æ–°        const description = this.getProductImageDescription(sequence)        const stage = 'PRODUCT_CAROUSEL'                console.log('ğŸ“‹ Product upload parameters:', {          filePath,          relatedType,          relatedId,          description,          stage,          sequence        })                const response = await uploadImage(          filePath,          relatedType,          relatedId,          description,          stage,          sequence        )                console.log('âœ… Product upload API response:', response)                if (response.code === 200 && response.data) {          return {            ...response.data,            fileUrl: response.data.fileUrl,            mediaId: response.data.mediaId,            fileName: response.data.fileName,            fileSize: response.data.fileSize          }        } else {          throw new Error(response.msg || response.message || 'ä¸Šä¼ å¤±è´¥')        }              } catch (error) {        console.error('âŒ Product image upload failed:', error)        throw error      }    },    // è·å–å•†å“å›¾ç‰‡æè¿°    getProductImageDescription(sequence) {      const descriptions = [        'å•†å“è½®æ’­å›¾1',        'å•†å“è½®æ’­å›¾2',         'å•†å“è½®æ’­å›¾3',        'å•†å“è½®æ’­å›¾4',        'å•†å“è½®æ’­å›¾5',        'å•†å“è½®æ’­å›¾6',        'å•†å“è½®æ’­å›¾7',        'å•†å“è½®æ’­å›¾8',        'å•†å“è½®æ’­å›¾9',        'å•†å“è½®æ’­å›¾10'      ]      return descriptions[sequence] || `å•†å“è½®æ’­å›¾${sequence + 1}`    },    // åˆ é™¤å›¾ç‰‡ - ä½¿ç”¨ä¸è®¾è®¡å¸ˆå…¥é©»ç›¸åŒçš„åˆ é™¤é€»è¾‘    async removeImage(index) {      uni.showModal({        title: 'ç¡®è®¤åˆ é™¤',        content: 'ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ',        success: async (res) => {          if (res.confirm) {            const image = this.productImages[index]                        // å¦‚æœå›¾ç‰‡å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè°ƒç”¨åˆ é™¤API            if (image.mediaId) {              try {                console.log('ğŸ—‘ï¸ Deleting product image from server, mediaId:', image.mediaId)                await deleteImage(image.mediaId)              } catch (error) {                console.error('åˆ é™¤æœåŠ¡å™¨å›¾ç‰‡å¤±è´¥:', error)                // å³ä½¿æœåŠ¡å™¨åˆ é™¤å¤±è´¥ï¼Œä¹Ÿå…è®¸ä»æœ¬åœ°ç§»é™¤              }            }                        // ä»é¢„è§ˆåˆ—è¡¨ä¸­ç§»é™¤            this.productImages.splice(index, 1)                        uni.showToast({              title: 'å›¾ç‰‡å·²åˆ é™¤',              icon: 'success'            })          }        }      })    },        // è§„æ ¼ç®¡ç†    addSpecification() {      if (this.specifications.length >= 2) {        uni.showToast({          title: 'æœ€å¤šåªèƒ½æ·»åŠ 2ä¸ªè§„æ ¼ç±»å‹',          icon: 'none'        })        return      }            const spec = {        id: 'spec_' + Date.now(),        name: '',        values: [],        newValue: ''      }            this.specifications.push(spec)      this.generatePriceStockTable()      this.productData.specType = this.specifications.length > 0 ? '2' : '0'    },        removeSpecification(specId) {      uni.showModal({        title: 'ç¡®è®¤åˆ é™¤',        content: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§„æ ¼ç±»å‹å—ï¼Ÿ',        success: (res) => {          if (res.confirm) {            this.specifications = this.specifications.filter(spec => spec.id !== specId)            this.generatePriceStockTable()            this.productData.specType = this.specifications.length > 0 ? '2' : '0'          }        }      })    },        addSpecValue(specId) {      const spec = this.specifications.find(s => s.id === specId)      if (spec && spec.newValue && spec.newValue.trim()) {        const value = spec.newValue.trim()        if (!spec.values.includes(value)) {          spec.values.push(value)          spec.newValue = ''          this.generatePriceStockTable()        } else {          uni.showToast({            title: 'è§„æ ¼å€¼å·²å­˜åœ¨',            icon: 'none'          })        }      }    },        removeSpecValue(specId, value) {      const spec = this.specifications.find(s => s.id === specId)      if (spec) {        spec.values = spec.values.filter(v => v !== value)        this.generatePriceStockTable()      }    },        updateSpecName(specId, newName) {      const spec = this.specifications.find(s => s.id === specId)      if (spec) {        spec.name = newName        this.generatePriceStockTable()      }    },        // ä»·æ ¼åº“å­˜ç®¡ç†    generatePriceStockTable() {      if (this.specifications.length === 0) {        this.priceStockData = [{          values: [],          stock: '',          singlePrice: '',          status: 'on'        }]        return      }            const combinations = this.generateCombinations()      combinations.forEach((combination, index) => {        const existingData = this.priceStockData[index]        if (existingData) {          combination.stock = existingData.stock || ''          combination.singlePrice = existingData.singlePrice || ''          combination.status = existingData.status || 'on'        }      })      this.priceStockData = combinations    },        generateCombinations() {      if (this.specifications.length === 0) return []            const generate = (specIndex, currentCombination) => {        if (specIndex >= this.specifications.length) {          return [{            ...currentCombination,            status: 'on'          }]        }                const spec = this.specifications[specIndex]        let combinations = []                for (const value of spec.values) {          const newCombination = {            ...currentCombination,            values: (currentCombination.values || []).concat([value])          }          combinations = combinations.concat(generate(specIndex + 1, newCombination))        }                return combinations      }            return generate(0, { values: [] })    },        toggleStatus(index) {      if (this.priceStockData[index]) {        this.priceStockData[index].status =           this.priceStockData[index].status === 'on' ? 'off' : 'on'      }    },        batchSetValues() {      if (!this.batchStock && !this.batchSinglePrice) {        uni.showToast({          title: 'è¯·å¡«å†™è¦æ‰¹é‡è®¾ç½®çš„å€¼',          icon: 'none'        })        return      }            this.priceStockData.forEach((item) => {        if (this.batchStock) {          item.stock = this.batchStock        }        if (this.batchSinglePrice) {          item.singlePrice = this.batchSinglePrice        }      })            uni.showToast({        title: 'æ‰¹é‡è®¾ç½®æˆåŠŸ',        icon: 'success'      })      this.batchStock = ''      this.batchSinglePrice = ''    },        // è®¡ç®—æ€»åº“å­˜    calculateTotalStock() {      if (this.specifications.length === 0) {        return parseInt(this.priceStockData[0].stock) || 0      }            return this.priceStockData.reduce((total, item) => {        return total + (parseInt(item.stock) || 0)      }, 0)    },        // æ„å»ºSKUåˆ—è¡¨æ•°æ® - æ ¹æ®ProductSkuDTOç»“æ„è°ƒæ•´    buildSkuList() {      if (this.specifications.length === 0) {        const item = this.priceStockData[0]        return [{          stockQuantity: Number(item.stock) || 0,          salePrice: Number(item.singlePrice) || 0,          costPrice: Number(item.singlePrice) * 0.8 || 0,          skuStatus: item.status === 'on' ? '0' : '2', // ä½¿ç”¨å­—ç¬¦ä¸² '0' æˆ– '2'          skuDetail: JSON.stringify({            type: 'single',            productName: this.productData.productName,            description: 'å•è§„æ ¼å•†å“'          })        }]      } else {        return this.priceStockData.map((item, index) => {          const specValues = item.values || []          const specCombination = this.specifications.map((spec, specIndex) => ({            name: spec.name,            value: specValues[specIndex] || ''          }))                    const specDescription = specCombination.map(spec => `${spec.name}:${spec.value}`).join(';')          const skuName = `${this.productData.productName} ${specDescription}`                    return {            stockQuantity: Number(item.stock) || 0,            salePrice: Number(item.singlePrice) || 0,            costPrice: Number(item.singlePrice) * 0.8 || 0,            skuStatus: item.status === 'on' ? '0' : '2', // ä½¿ç”¨å­—ç¬¦ä¸² '0' æˆ– '2'            skuDetail: JSON.stringify({              type: 'multi',              combination: specCombination,              description: specDescription,              skuName: skuName,              index: index            })          }        })      }    },        // è°ƒè¯•SPUæ•°æ®    debugSPUData() {      const spuData = {        productName: this.productData.productName.trim(),        productDetail: this.productData.productDetail.trim(),        categoryId: Number(this.selectedCategory3Id),        productStatus: '0',        specType: this.specifications.length > 0 ? '2' : '0',        marketPrice: Number(this.referencePrice) || 0,        costPrice: Number(this.referencePrice) * 0.8 || 0,        stock: this.calculateTotalStock(),        level1CategoryId: Number(this.selectedCategory1Id),        level2CategoryId: Number(this.selectedCategory2Id)      }      if (this.specifications.length > 0) {        spuData.skuList = this.buildSkuList()      }      console.log('ğŸ” SPUæ•°æ®è°ƒè¯•ä¿¡æ¯:')      console.log('åŸå§‹æ•°æ®:', spuData)      console.log('æ•°æ®ç±»å‹æ£€æŸ¥:')      Object.keys(spuData).forEach(key => {        if (key === 'skuList') {          console.log(`  ${key}: Array(${spuData[key].length})`)        } else {          console.log(`  ${key}: ${spuData[key]} (${typeof spuData[key]})`)        }      })            // æ£€æŸ¥æ˜¯å¦æœ‰ç©ºå€¼æˆ–æ— æ•ˆå€¼      const invalidFields = Object.keys(spuData).filter(key => {        if (key === 'skuList') return false // è·³è¿‡skuListæ£€æŸ¥        const value = spuData[key]        return value === null || value === undefined || value === '' || (typeof value === 'number' && isNaN(value))      })            if (invalidFields.length > 0) {        console.warn('âŒ æ— æ•ˆå­—æ®µ:', invalidFields)      } else {        console.log('âœ… æ‰€æœ‰å­—æ®µéƒ½æœ‰æ•ˆ')      }            return spuData    },        // éªŒè¯è¡¨å•    validateForm() {      console.log('å¼€å§‹è¡¨å•éªŒè¯...')            // éªŒè¯å•†å“æ ‡é¢˜      if (!this.productData.productName || this.productData.productName.trim() === '') {        throw new Error('è¯·è¾“å…¥å•†å“æ ‡é¢˜')      }            if (this.productData.productName.trim().length < 2) {        throw new Error('å•†å“æ ‡é¢˜è‡³å°‘2ä¸ªå­—ç¬¦')      }      // éªŒè¯åˆ†ç±»      if (!this.selectedCategory3Id) {        throw new Error('è¯·é€‰æ‹©å®Œæ•´çš„ä¸‰çº§åˆ†ç±»')      }      // éªŒè¯å›¾ç‰‡      if (this.productImages.length === 0) {        throw new Error('è¯·ä¸Šä¼ è‡³å°‘1å¼ å•†å“å›¾ç‰‡')      }      // éªŒè¯è§„æ ¼      for (let i = 0; i < this.specifications.length; i++) {        const spec = this.specifications[i]        if (!spec.name || spec.name.trim() === '') {          throw new Error('è¯·å¡«å†™è§„æ ¼åç§°')        }                if (spec.values.length === 0) {          throw new Error('è¯·ä¸º"' + spec.name + '"æ·»åŠ è§„æ ¼å€¼')        }                // éªŒè¯è§„æ ¼å€¼æ˜¯å¦é‡å¤        const uniqueValues = [...new Set(spec.values)]        if (uniqueValues.length !== spec.values.length) {          throw new Error('"' + spec.name + '"ä¸­å­˜åœ¨é‡å¤çš„è§„æ ¼å€¼')        }      }      // éªŒè¯ä»·æ ¼å’Œåº“å­˜      let hasValidItem = false      for (let i = 0; i < this.priceStockData.length; i++) {        const item = this.priceStockData[i]        const stock = parseInt(item.stock)        const price = parseFloat(item.singlePrice)                if (!item.stock || isNaN(stock) || stock < 0) {          throw new Error('è¯·å¡«å†™æœ‰æ•ˆçš„åº“å­˜æ•°é‡')        }                if (!item.singlePrice || isNaN(price) || price <= 0) {          throw new Error('è¯·å¡«å†™æœ‰æ•ˆçš„ä»·æ ¼')        }                if (price > 999999) {          throw new Error('ä»·æ ¼ä¸èƒ½è¶…è¿‡999999å…ƒ')        }                hasValidItem = true      }            if (!hasValidItem) {        throw new Error('è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªæœ‰æ•ˆçš„ä»·æ ¼åº“å­˜é¡¹')      }            // éªŒè¯å‚è€ƒä»·      const referencePrice = parseFloat(this.referencePrice)      if (isNaN(referencePrice) || referencePrice < 0) {        throw new Error('è¯·å¡«å†™æœ‰æ•ˆçš„å•†å“å‚è€ƒä»·')      }            console.log('è¡¨å•éªŒè¯é€šè¿‡')    },        // æ˜¾ç¤ºæäº¤ç»“æœ    showSubmitResult(result) {      const { spuId, imageUpdateResult, hasImages, hasSpecs } = result            let message = 'å•†å“åˆ›å»ºæˆåŠŸï¼\n'      message += `å•†å“ID: ${spuId}\n`            if (hasImages) {        message += `å›¾ç‰‡: ${this.productImages.length}å¼ å·²ä¸Šä¼ \n`        if (!imageUpdateResult.success) {          message += `(å›¾ç‰‡å…³è”æ›´æ–°å¯èƒ½å­˜åœ¨é—®é¢˜)\n`        }      }            if (hasSpecs) {        message += `è§„æ ¼: ${this.priceStockData.length}ä¸ªSKUåˆ›å»ºæˆåŠŸ\n`      }            uni.showModal({        title: 'æäº¤æˆåŠŸ',        content: message,        showCancel: false,        confirmText: 'ç¡®å®š',        success: (res) => {          if (res.confirm) {            // è¿”å›ä¸Šä¸€é¡µ            setTimeout(() => {              uni.navigateBack()            }, 500)          }        }      })    },        // æ›´æ–°å•†å“å›¾ç‰‡å…³è”ä¿¡æ¯ - ä½¿ç”¨ä¸è®¾è®¡å¸ˆå…¥é©»ç›¸åŒçš„é€»è¾‘    async updateProductImagesRelation(spuId) {      console.log('æ›´æ–°å•†å“å›¾ç‰‡å…³è”ä¿¡æ¯ï¼ŒSPU ID:', spuId)            // ç”±äºå›¾ç‰‡æ˜¯åœ¨åˆ›å»ºSPUå‰ä¸Šä¼ çš„ï¼ŒrelatedIdä¸º0      // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯èƒ½éœ€è¦åç«¯æä¾›æ›´æ–°å…³è”ä¿¡æ¯çš„æ¥å£            return {        success: true,        updatedCount: this.productImages.length,        message: 'å•†å“å›¾ç‰‡å…³è”ä¿¡æ¯å·²è®°å½•'      }    },        // æäº¤å•†å“    async submitProduct() {      if (this.loading) return            try {        console.log('å¼€å§‹æäº¤å•†å“ï¼Œå½“å‰æ•°æ®:', {          æ­¥éª¤: this.currentStep,          åˆ†ç±»ID: this.selectedCategory3Id,          å•†å“åç§°: this.productData.productName,          å›¾ç‰‡æ•°é‡: this.productImages.length,          è§„æ ¼æ•°é‡: this.specifications.length,          ä»·æ ¼åº“å­˜é¡¹: this.priceStockData.length        })                // éªŒè¯è¡¨å•        this.validateForm()                this.loading = true        uni.showLoading({          title: 'æäº¤ä¸­...',          mask: true        })        // è°ƒè¯•SPUæ•°æ®ç»“æ„        console.log('ğŸ” è°ƒè¯•SPUæ•°æ®ç»“æ„...')        this.debugSPUData()        // 1. æ„å»ºSPUæ•°æ® - æ ¹æ®ProductSpuDTOç»“æ„è°ƒæ•´        const spuData = {          productName: this.productData.productName.trim(),          productDetail: this.productData.productDetail.trim(),          categoryId: Number(this.selectedCategory3Id), // ä½¿ç”¨categoryIdå­—æ®µ          productStatus: '0', // é»˜è®¤ä¸‹æ¶çŠ¶æ€          specType: this.specifications.length > 0 ? '2' : '0', // å¤šè§„æ ¼ä¸º'2'ï¼Œå•è§„æ ¼ä¸º'0'          marketPrice: Number(this.referencePrice) || 0,          costPrice: Number(this.referencePrice) * 0.8 || 0, // æˆæœ¬ä»·è®¾ä¸ºå¸‚åœºä»·çš„80%          stock: this.calculateTotalStock(),          // æ·»åŠ åˆ†ç±»å±‚çº§ä¿¡æ¯ç”¨äºéªŒè¯          level1CategoryId: Number(this.selectedCategory1Id),          level2CategoryId: Number(this.selectedCategory2Id)        }        console.log('æäº¤SPUæ•°æ®:', spuData)        console.log('SPUæ•°æ®ç±»å‹æ£€æŸ¥:', {          productName: typeof spuData.productName,          productDetail: typeof spuData.productDetail,          categoryId: { value: spuData.categoryId, type: typeof spuData.categoryId },          productStatus: { value: spuData.productStatus, type: typeof spuData.productStatus },          specType: { value: spuData.specType, type: typeof spuData.specType },          marketPrice: { value: spuData.marketPrice, type: typeof spuData.marketPrice },          costPrice: { value: spuData.costPrice, type: typeof spuData.costPrice },          stock: { value: spuData.stock, type: typeof spuData.stock }        })                // 2. å¦‚æœæœ‰è§„æ ¼ï¼Œæ„å»ºSKUåˆ—è¡¨        if (this.specifications.length > 0) {          const skuList = this.buildSkuList()          console.log('SKUåˆ—è¡¨:', skuList)          spuData.skuList = skuList        }                // 3. åˆ›å»ºSPUï¼ˆåŒ…å«SKUåˆ—è¡¨ï¼‰        const spuResponse = await addProductSpu(spuData)                if (spuResponse.code === 200) {          const spuId = spuResponse.data                    console.log('SPUåˆ›å»ºæˆåŠŸï¼ŒID:', spuId)                    // 4. å¦‚æœæœ‰å›¾ç‰‡ï¼Œæ›´æ–°å›¾ç‰‡çš„å…³è”ä¿¡æ¯          let imageUpdateResult = { success: true, updatedCount: 0 }          if (this.productImages.length > 0) {            try {              imageUpdateResult = await this.updateProductImagesRelation(spuId)              console.log('å›¾ç‰‡å…³è”æ›´æ–°ç»“æœ:', imageUpdateResult)            } catch (updateError) {              console.error('å›¾ç‰‡å…³è”æ›´æ–°å¤±è´¥:', updateError)              imageUpdateResult = {                success: false,                error: updateError.message,                updatedCount: 0              }            }          }                    uni.hideLoading()                    // 5. æ˜¾ç¤ºæœ€ç»ˆç»“æœ          this.showSubmitResult({            spuId,            imageUpdateResult,            hasImages: this.productImages.length > 0,            hasSpecs: this.specifications.length > 0          })                  } else {          // æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯          console.error('SPUåˆ›å»ºå¤±è´¥å“åº”:', spuResponse)          let errorMessage = spuResponse.message || 'åˆ›å»ºå•†å“å¤±è´¥'                    // å¦‚æœæœ‰å…·ä½“çš„æ ¡éªŒé”™è¯¯ä¿¡æ¯ï¼Œæ˜¾ç¤ºå‡ºæ¥          if (spuResponse.data && Array.isArray(spuResponse.data) && spuResponse.data.length > 0) {            const fieldErrors = spuResponse.data.map(error => {              return `${error.field || 'å­—æ®µ'}: ${error.message || 'æ ¡éªŒå¤±è´¥'}`            })            errorMessage += `\n${fieldErrors.join('\n')}`          }                    throw new Error(errorMessage)        }              } catch (error) {        uni.hideLoading()        console.error('æäº¤å•†å“å¤±è´¥:', error)        uni.showToast({          title: error.message || 'æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•',          icon: 'none',          duration: 5000        })      } finally {        this.loading = false      }    }  },    async onLoad() {    // é¡µé¢åŠ è½½æ—¶åªåŠ è½½ä¸€çº§åˆ†ç±»    await this.loadLevel1Categories()  },    watch: {    priceStockData: {      handler(newVal) {        if (newVal && newVal.length > 0) {          const prices = newVal            .map(item => parseFloat(item.singlePrice) || 0)            .filter(price => price > 0)                    if (prices.length > 0) {            this.productData.marketPrice = Math.max.apply(null, prices)            this.productData.costPrice = Math.min.apply(null, prices)            this.referencePrice = (this.productData.marketPrice * 1.2).toFixed(2)          }        }      },      deep: true    }  }}</script><style scoped>/* æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œä¸ä¹‹å‰ç›¸åŒ */.container {  padding: 20rpx;  background-color: #f8f8f8;  min-height: 100vh;}.header {  text-align: center;  margin-bottom: 30rpx;}.title {  display: block;  font-size: 36rpx;  font-weight: bold;  color: #333;  margin-bottom: 10rpx;}.subtitle {  display: block;  font-size: 24rpx;  color: #666;}.upload-container {  background: white;  border-radius: 16rpx;  padding: 30rpx;  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.1);}.steps {  display: flex;  justify-content: space-between;  margin-bottom: 40rpx;  position: relative;}.steps::before {  content: '';  position: absolute;  top: 40rpx;  left: 20%;  right: 20%;  height: 4rpx;  background: #e0e0e0;  z-index: 1;}.step {  display: flex;  flex-direction: column;  align-items: center;  position: relative;  z-index: 2;  flex: 1;}.step-number {  width: 80rpx;  height: 80rpx;  border-radius: 50%;  background: #e0e0e0;  color: white;  display: flex;  align-items: center;  justify-content: center;  font-size: 32rpx;  margin-bottom: 10rpx;  transition: all 0.3s;}.step.active .step-number {  background: #007AFF;}.step-text {  font-size: 24rpx;  color: #999;}.step.active .step-text {  color: #007AFF;  font-weight: bold;}.step-content {  max-height: 70vh;}.step-panel {  padding: 20rpx 0;}.form-group {  margin-bottom: 40rpx;}.form-label {  display: block;  font-size: 28rpx;  font-weight: bold;  color: #333;  margin-bottom: 20rpx;}.picker-group {  margin-bottom: 30rpx;}.picker-group:last-child {  margin-bottom: 0;}.picker-label {  display: block;  font-size: 26rpx;  color: #333;  margin-bottom: 15rpx;}.picker {  background: white;  border: 2rpx solid #e0e0e0;  border-radius: 12rpx;  padding: 20rpx;}.picker-text {  font-size: 28rpx;  color: #333;  display: flex;  align-items: center;  justify-content: space-between;}.picker-text.disabled {  color: #999;  background: #f5f5f5;}.picker-text.loading {  color: #007AFF;}.loading-indicator {  color: #007AFF;  font-size: 24rpx;}.category-status {  background: #e8f5e8;  border: 2rpx solid #4CAF50;  border-radius: 12rpx;  padding: 20rpx;  margin-top: 20rpx;}.status-text {  font-size: 26rpx;  color: #2E7D32;  margin-right: 10rpx;}.category-path {  font-size: 26rpx;  color: #2E7D32;  font-weight: bold;}.error-message {  background: #ffebee;  border: 2rpx solid #f44336;  border-radius: 12rpx;  padding: 20rpx;  margin-top: 20rpx;  text-align: center;}.error-message text:first-child {  display: block;  font-size: 26rpx;  color: #d32f2f;  margin-bottom: 10rpx;}.retry-text {  font-size: 26rpx;  color: #007AFF;  text-decoration: underline;}.upload-area {  border: 2rpx dashed #007AFF;  border-radius: 12rpx;  padding: 60rpx 30rpx;  text-align: center;  background: #f0f8ff;  transition: all 0.3s ease;}.upload-area.drag-over {  background: #e3f2fd;  border-color: #2196F3;  border-style: solid;}.upload-icon {  display: block;  font-size: 60rpx;  margin-bottom: 20rpx;}.upload-text {  display: block;  font-size: 28rpx;  color: #007AFF;  margin-bottom: 10rpx;}.upload-tip {  display: block;  font-size: 24rpx;  color: #666;}.upload-status {  background: #e3f2fd;  border: 1rpx solid #2196F3;  border-radius: 8rpx;  padding: 15rpx;  margin-top: 15rpx;  text-align: center;}.upload-status-text {  font-size: 24rpx;  color: #1976D2;}.upload-tips {  margin-top: 15rpx;  padding: 0 10rpx;}.tip-text {  display: block;  font-size: 22rpx;  color: #666;  margin-bottom: 5rpx;}.image-preview {  display: flex;  flex-wrap: wrap;  gap: 20rpx;  margin-top: 20rpx;}.preview-item {  position: relative;  width: 200rpx;  height: 200rpx;  border-radius: 12rpx;  overflow: hidden;  border: 2rpx solid #e0e0e0;}.preview-image {  width: 100%;  height: 100%;}.remove {  position: absolute;  top: 8rpx;  right: 8rpx;  width: 40rpx;  height: 40rpx;  background: rgba(0,0,0,0.7);  color: white;  border-radius: 50%;  display: flex;  align-items: center;  justify-content: center;  font-size: 24rpx;  font-weight: bold;  z-index: 2;}.upload-success {  position: absolute;  bottom: 8rpx;  right: 8rpx;  width: 30rpx;  height: 30rpx;  background: #4CAF50;  color: white;  border-radius: 50%;  display: flex;  align-items: center;  justify-content: center;  font-size: 18rpx;  font-weight: bold;}.success-icon {  font-size: 18rpx;}.empty-preview {  width: 100%;  padding: 40rpx;  text-align: center;  background: #f9f9f9;  border-radius: 12rpx;  border: 2rpx dashed #e0e0e0;}.empty-text {  font-size: 26rpx;  color: #999;}.description-container {  margin-top: 10rpx;}.specifications-container {  margin-bottom: 30rpx;}.specification-container {  border: 2rpx solid #e0e0e0;  border-radius: 12rpx;  margin-bottom: 30rpx;  overflow: hidden;  background: white;}.spec-header {  display: flex;  align-items: center;  justify-content: space-between;  background: #f8f9fa;  padding: 20rpx;  border-bottom: 2rpx solid #e0e0e0;}.spec-name-input {  flex: 1;  margin-right: 20rpx;}.delete-spec {  color: #ff4757;  font-size: 26rpx;  padding: 8rpx 16rpx;  border-radius: 6rpx;  background: #fff5f5;  border: 1rpx solid #ff4757;  white-space: nowrap;}.spec-body {  padding: 20rpx;}.spec-values {  display: flex;  flex-wrap: wrap;  gap: 15rpx;  margin-bottom: 20rpx;}.spec-value-item {  background: #e3f2fd;  border: 1rpx solid #2196F3;  border-radius: 20rpx;  padding: 12rpx 20rpx;  display: flex;  align-items: center;  gap: 10rpx;  font-size: 24rpx;}.remove-value {  color: #ff4757;  font-size: 20rpx;  font-weight: bold;  cursor: pointer;  width: 24rpx;  height: 24rpx;  display: flex;  align-items: center;  justify-content: center;  border-radius: 50%;  background: white;}/* ä¿®æ”¹åçš„è§„æ ¼å€¼æ·»åŠ å®¹å™¨ */.add-value-container {  display: flex;  gap: 15rpx;  align-items: center;  width: 100%;}.add-value-input-wrapper {  flex: 1;  min-width: 0;}/* æ·»åŠ æŒ‰é’®æ ·å¼ - ä¸åˆ é™¤æŒ‰é’®ä¿æŒä¸€è‡´æ ¼å¼ */.add-value-btn {  color: #2196F3;  font-size: 26rpx;  padding: 8rpx 16rpx;  border-radius: 6rpx;  background: #e3f2fd;  white-space: nowrap;  border: 1rpx solid #2196F3;  height: auto;  line-height: 1.4;  display: flex;  align-items: center;  justify-content: center;  min-width: 120rpx;}/* è§„æ ¼ç±»å‹æ·»åŠ æŒ‰é’® */.add-spec-btn {  display: flex;  align-items: center;  justify-content: center;  border: 2rpx dashed #007AFF;  border-radius: 12rpx;  padding: 20rpx;  color: #007AFF;  gap: 8rpx;  background: #f0f8ff;  font-size: 26rpx;}.add-icon {  font-size: 32rpx;  font-weight: bold;}.spec-count {  color: #666;  font-size: 24rpx;}.warning-text {  display: block;  font-size: 24rpx;  color: #ff6b35;  margin-bottom: 20rpx;  background: #fff3e0;  padding: 15rpx;  border-radius: 8rpx;  line-height: 1.4;}.price-stock-container {  border: 2rpx solid #e0e0e0;  border-radius: 12rpx;  overflow: hidden;}.table {  width: 100%;}.table-header {  background: #f5f5f5;}.table-row {  display: flex;  border-bottom: 1rpx solid #e0e0e0;}.table-row:last-child {  border-bottom: none;}.table-header-cell {  flex: 1;  padding: 20rpx 15rpx;  font-size: 26rpx;  font-weight: bold;  color: #333;  text-align: center;  border-right: 1rpx solid #e0e0e0;  display: flex;  align-items: center;  justify-content: center;}.table-header-cell:last-child {  border-right: none;}.required-field::after {  content: '*';  color: #ff4757;  margin-left: 4rpx;}.table-body .table-row:nth-child(even) {  background: #fafafa;}.table-cell {  flex: 1;  padding: 15rpx 10rpx;  font-size: 26rpx;  color: #333;  text-align: center;  border-right: 1rpx solid #e0e0e0;  display: flex;  align-items: center;  justify-content: center;  min-height: 80rpx;}.table-cell:last-child {  border-right: none;}.status-badge {  background: #4CAF50;  color: white;  padding: 8rpx 16rpx;  border-radius: 20rpx;  font-size: 24rpx;  min-width: 80rpx;  text-align: center;}.status-off {  background: #ff6b35;}.batch-setting {  background: #f8f9fa;  padding: 20rpx;  border-top: 1rpx solid #e0e0e0;}.batch-label {  font-size: 26rpx;  color: #333;  margin-bottom: 15rpx;  display: block;  font-weight: bold;}.batch-inputs {  display: flex;  gap: 15rpx;  align-items: center;}.batch-inputs .uni-easyinput {  flex: 1;}.batch-btn {  white-space: nowrap;  background: #ff9800;  color: white;  border: none;  border-radius: 8rpx;  padding: 15rpx 25rpx;  font-size: 24rpx;}.price-section {  background: #f8f9fa;  border-radius: 12rpx;  padding: 30rpx;  margin-top: 30rpx;  border: 2rpx solid #e0e0e0;}.price-header {  display: flex;  justify-content: space-between;  align-items: center;  margin-bottom: 20rpx;}.price-title {  font-size: 28rpx;  font-weight: bold;  color: #333;}.price-tip {  font-size: 24rpx;  color: #666;}.reference-price {  display: flex;  align-items: center;  gap: 20rpx;}.reference-price .uni-easyinput {  flex: 1;}.price-unit {  font-size: 28rpx;  color: #333;  font-weight: bold;  min-width: 60rpx;}.action-buttons {  display: flex;  justify-content: space-between;  margin-top: 50rpx;  gap: 20rpx;}.btn {  flex: 1;  border: none;  border-radius: 12rpx;  padding: 25rpx;  font-size: 28rpx;  font-weight: bold;  transition: all 0.3s;  display: flex;  align-items: center;  justify-content: center;}.btn:disabled {  opacity: 0.6;  cursor: not-allowed;}.btn-secondary {  background: #6c757d;  color: white;}.btn-primary {  background: #007AFF;  color: white;}.btn-success {  background: #4CAF50;  color: white;}.btn-mini {  padding: 15rpx 25rpx;  font-size: 24rpx;  flex: none;}.btn-mini.batch-btn {  background: #ff9800;  color: white;}/* å“åº”å¼è®¾è®¡ */@media (max-width: 750rpx) {  .container {    padding: 15rpx;  }    .upload-container {    padding: 20rpx;  }    .steps {    margin-bottom: 30rpx;  }    .step-number {    width: 60rpx;    height: 60rpx;    font-size: 28rpx;  }    .step-text {    font-size: 22rpx;  }    .picker-group {    margin-bottom: 20rpx;  }    .upload-area {    padding: 40rpx 20rpx;  }    .preview-item {    width: 150rpx;    height: 150rpx;  }    .spec-header {    padding: 15rpx;    flex-direction: column;    gap: 15rpx;  }    .spec-name-input {    margin-right: 0;    width: 100%;  }    .delete-spec {    align-self: flex-end;  }    .spec-body {    padding: 15rpx;  }    .spec-value-item {    padding: 8rpx 15rpx;    font-size: 22rpx;  }    .add-value-container {    flex-direction: column;    gap: 10rpx;  }    .add-value-input-wrapper {    width: 100%;  }    .add-value-btn {    width: 100%;    min-width: auto;  }    .table-header-cell {    padding: 15rpx 10rpx;    font-size: 24rpx;  }    .table-cell {    padding: 10rpx 5rpx;    font-size: 24rpx;  }    .batch-inputs {    flex-direction: column;    gap: 10rpx;  }    .batch-inputs .uni-easyinput {    width: 100%;  }    .action-buttons {    flex-direction: column;    gap: 15rpx;  }    .btn {    width: 100%;  }}</style>