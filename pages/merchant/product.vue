<template>
  <view class="product-management">
    <!-- ÊêúÁ¥¢ÂíåÊ∑ªÂä†ÊåâÈíÆ -->
    <view class="top-section">
      <view class="search-box">
        <uni-icons type="search" size="18" color="#999"></uni-icons>
        <input 
          class="search-input" 
          placeholder="ÊêúÁ¥¢‰∫ßÂìÅÂêçÁß∞„ÄÅÁ±ªÂà´„ÄÅËØ¶ÊÉÖ..." 
          v-model="searchQuery"
          @input="handleSearch"
        />
        <uni-icons 
          v-if="searchQuery" 
          type="clear" 
          size="18" 
          color="#999"
          @click="searchQuery = ''; handleSearch()"
          class="clear-icon"
        ></uni-icons>
      </view>
      <button class="add-btn" @click="handleAddProduct">
        <uni-icons type="plus" size="16" color="#fff"></uni-icons>
        ‰∏äÊû∂Êñ∞‰∫ßÂìÅ
      </button>
    </view>

    <!-- Á≠õÈÄâÊ†è -->
    <view class="filter-section">
      <view class="filter-group">
        <picker 
          @change="onCategoryChange" 
          :value="categoryIndex" 
          :range="categoryOptions"
          class="filter-picker"
        >
          <view class="filter-box">
            <text class="filter-text">{{ categoryOptions[categoryIndex] }}</text>
            <uni-icons type="arrowdown" size="14" color="#666"></uni-icons>
          </view>
        </picker>
        
        <picker 
          @change="onStatusChange" 
          :value="statusIndex" 
          :range="statusOptions"
          class="filter-picker"
        >
          <view class="filter-box">
            <text class="filter-text">{{ statusOptions[statusIndex] }}</text>
            <uni-icons type="arrowdown" size="14" color="#666"></uni-icons>
          </view>
        </picker>
      </view>
    </view>

    <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
    <view class="loading-state" v-if="loading && products.length === 0">
      <uni-load-more status="loading" content="Ê≠£Âú®Âä†ËΩΩ..."></uni-load-more>
    </view>

    <!-- ‰∫ßÂìÅÁΩëÊ†º -->
    <scroll-view 
      class="product-grid" 
      scroll-y
      @scrolltolower="handleReachBottom"
      refresher-enabled
      :refresher-triggered="refreshing"
      @refresherrefresh="handlePullDownRefresh"
    >
      <view class="grid-container">
        <view 
          class="product-card" 
          v-for="(product, index) in filteredProducts" 
          :key="product.id"
        >
          <!-- ÂïÜÂìÅÂõæÁâá -->
          <view class="product-image">
            <image 
              :src="product.image" 
              mode="aspectFill" 
              class="image"
              @error="onImageError(product)"
              lazy-load
            ></image>
            <!-- Áä∂ÊÄÅÊ†áÁ≠æ -->
            <view class="status-badge" :class="product.status === '0' ? 'status-on' : 'status-off'">
              {{ product.status === '0' ? '‰∏äÊû∂' : '‰∏ãÊû∂' }}
            </view>
          </view>
          
          <!-- ÂïÜÂìÅ‰ø°ÊÅØ -->
          <view class="product-info">
            <text class="product-name">{{ product.productName }}</text>
            <text class="product-category">{{ product.categoryName }}</text>
            <text class="product-detail">{{ product.productDetail }}</text>
            <text class="product-price">{{ product.price }}</text>
            <text class="product-stock">Â∫ìÂ≠ò: {{ product.stock }}</text>
          </view>
          
          <!-- Êìç‰ΩúÊåâÈíÆ -->
          <view class="action-buttons">
            <button class="status-btn" @click="toggleProductStatus(product)" :disabled="actionLoading">
              <uni-icons 
                :type="product.status === '0' ? 'arrowdown' : 'arrowup'" 
                size="14" 
                :color="product.status === '0' ? '#E6A23C' : '#67C23A'"
              ></uni-icons>
              {{ product.status === '0' ? '‰∏ãÊû∂' : '‰∏äÊû∂' }}
            </button>
            <button class="edit-btn" @click="handleEdit(product)" :disabled="actionLoading">
              <uni-icons type="compose" size="14" color="#409EFF"></uni-icons>
              ÁºñËæë
            </button>
            <button class="delete-btn" @click="handleDelete(product)" :disabled="actionLoading">
              <uni-icons type="trash" size="14" color="#F56C6C"></uni-icons>
              Âà†Èô§
            </button>
          </view>
        </view>
      </view>

      <!-- Âä†ËΩΩÊõ¥Â§ö -->
      <view class="load-more" v-if="products.length > 0">
        <uni-load-more 
          :status="loadMoreStatus" 
          :content-text="{
            contentdown: '‰∏äÊãâÂä†ËΩΩÊõ¥Â§ö',
            contentrefresh: 'Ê≠£Âú®Âä†ËΩΩ...',
            contentnomore: 'Ê≤°ÊúâÊõ¥Â§öÊï∞ÊçÆ‰∫Ü'
          }"
        ></uni-load-more>
      </view>

      <!-- Á©∫Áä∂ÊÄÅ -->
      <view class="empty-state" v-if="!loading && filteredProducts.length === 0">
        <image src="/static/images/empty-product.png" class="empty-image"></image>
        <text class="empty-text">ÊöÇÊó†‰∫ßÂìÅÊï∞ÊçÆ</text>
        <button class="empty-btn" @click="handleAddProduct">Á´ãÂç≥Ê∑ªÂä†‰∫ßÂìÅ</button>
      </view>
    </scroll-view>
  </view>
</template>

<script>
import productApi from '@/api/productSpu.js';

export default {
  data() {
    return {
      searchQuery: '',
      categoryIndex: 0,
      statusIndex: 0,
      categoryOptions: ['ÂÖ®ÈÉ®', 'Âª∫Êùê', 'ÂÆ∂ÂÖ∑', 'ÁÅØÂÖ∑', 'Âé®Âç´', 'ËΩØË£Ö', 'È•∞ÂìÅ', 'ÂÆ∂Áîµ', 'ÂÖ®Â±ãÂÆöÂà∂', 'ÂÖ∂‰ªñ'],
      statusOptions: ['ÂÖ®ÈÉ®', '‰∏äÊû∂', '‰∏ãÊû∂'],
      products: [],
      loading: false,
      refreshing: false,
      loadMoreStatus: 'more',
      pageParams: {
        pageNum: 1,
        pageSize: 10,
        total: 0
      },
      searchTimer: null,
      actionLoading: false
    }
  },
  
  computed: {
    filteredProducts() {
      let filtered = [...this.products];
      
      // ÊêúÁ¥¢ËøáÊª§ - Ê∑ªÂä†ÂïÜÂìÅËØ¶ÊÉÖÊêúÁ¥¢
      if (this.searchQuery) {
        const query = this.searchQuery.toLowerCase();
        filtered = filtered.filter(product => 
          product.productName.toLowerCase().includes(query) || 
          (product.categoryName && product.categoryName.toLowerCase().includes(query)) ||
          (product.productDetail && product.productDetail.toLowerCase().includes(query))
        );
      }
      
      // Á±ªÂà´ËøáÊª§
      if (this.categoryIndex > 0) {
        const category = this.categoryOptions[this.categoryIndex];
        filtered = filtered.filter(product => 
          product.categoryName === category
        );
      }
      
      // Áä∂ÊÄÅËøáÊª§ ('0':‰∏äÊû∂, '2':‰∏ãÊû∂)
      if (this.statusIndex > 0) {
        const statusValue = this.statusIndex === 1 ? '0' : '2';
        filtered = filtered.filter(product => 
          product.status === statusValue
        );
      }
      
      return filtered;
    }
  },
  
  methods: {
    // Ê£ÄÊü•ÁΩëÁªúÁä∂ÊÄÅ
    async checkNetworkStatus() {
      return new Promise((resolve, reject) => {
        uni.getNetworkType({
          success: (res) => {
            console.log('üì∂ ÂΩìÂâçÁΩëÁªúÁä∂ÊÄÅ:', res.networkType);
            if (res.networkType === 'none') {
              reject(new Error('ÁΩëÁªúËøûÊé•‰∏çÂèØÁî®ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËÆæÁΩÆ'));
            } else {
              resolve();
            }
          },
          fail: (err) => {
            console.error('‚ùå ÁΩëÁªúÁä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:', err);
            reject(new Error('ÁΩëÁªúÁä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•'));
          }
        });
      });
    },

    // Âä†ËΩΩÂïÜÂìÅÂàóË°®
    async loadProducts() {
      if (this.loading && this.pageParams.pageNum > 1) {
        return;
      }
      
      this.loading = true;
      try {
        // Ê£ÄÊü•ÁΩëÁªúÁä∂ÊÄÅ
        await this.checkNetworkStatus();
        
        // ÊûÑÂª∫ËØ∑Ê±ÇÂèÇÊï∞
        const requestParams = {
          productName: this.searchQuery || '',
          category: this.categoryIndex > 0 ? this.categoryOptions[this.categoryIndex] : '',
          productStatus: this.getStatusValue(),
          pageNum: this.pageParams.pageNum,
          pageSize: this.pageParams.pageSize
        };
        
        console.log('üì§ ÂèëÈÄÅGETËØ∑Ê±ÇÂèÇÊï∞:', requestParams);
        const res = await productApi.getList(requestParams);
        console.log('‚úÖ Êé•Âè£ÂìçÂ∫îÊàêÂäü:', res);
        
        if (res.code === 200) {
          const productList = res.data || [];
          if (this.pageParams.pageNum === 1) {
            this.products = this.formatProductData(productList);
          } else {
            this.products = [...this.products, ...this.formatProductData(productList)];
          }
          
          this.pageParams.total = res.total || productList.length;
          
          if (this.products.length >= this.pageParams.total) {
            this.loadMoreStatus = 'noMore';
          } else {
            this.loadMoreStatus = 'more';
          }
          
          console.log(`‚úÖ ÊàêÂäüÂä†ËΩΩ ${this.products.length} ‰∏™ÂïÜÂìÅ`);
        } else {
          console.error('‚ùå Êé•Âè£ËøîÂõûÈîôËØØ:', res);
          uni.showToast({
            title: res.msg || 'Ëé∑ÂèñÂïÜÂìÅÂàóË°®Â§±Ë¥•',
            icon: 'none',
            duration: 3000
          });
        }
      } catch (error) {
        console.error('üí• Âä†ËΩΩÂïÜÂìÅÂàóË°®Â§±Ë¥•:', error);
        uni.showToast({
          title: error.message || 'Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',
          icon: 'none',
          duration: 3000
        });
      } finally {
        this.loading = false;
        this.refreshing = false;
        uni.stopPullDownRefresh();
      }
    },

    // Ëé∑ÂèñÁä∂ÊÄÅÂÄº ('0':‰∏äÊû∂, '2':‰∏ãÊû∂)
    getStatusValue() {
      if (this.statusIndex === 0) return ''; // ÂÖ®ÈÉ®
      if (this.statusIndex === 1) return '0'; // ‰∏äÊû∂
      if (this.statusIndex === 2) return '2'; // ‰∏ãÊû∂
      return '';
    },
    
    // Ê†ºÂºèÂåñÂïÜÂìÅÊï∞ÊçÆ
    formatProductData(products) {
      return products.map(product => ({
        id: product.productSpuId,
        productName: product.productName,
        categoryName: product.category || 'ÂÖ∂‰ªñ',
        productDetail: product.productDetail,
        price: `Ôø•${this.formatPrice(product.marketPrice)}`,
        status: product.productStatus || '2',
        image: product.mainImage || '/static/images/default-product.jpg',
        stock: product.stock || 0,
        originalData: product
      }));
    },
    
    // Ê†ºÂºèÂåñ‰ª∑Ê†º
    formatPrice(price) {
      if (!price) return '0.00';
      return parseFloat(price).toFixed(2);
    },
    
    onImageError(product) {
      console.log('üñºÔ∏è ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂõæÁâá');
      product.image = '/static/images/default-product.jpg';
    },
    
    handleSearch() {
      clearTimeout(this.searchTimer);
      this.searchTimer = setTimeout(() => {
        this.pageParams.pageNum = 1;
        this.loadProducts();
      }, 500);
    },
    
    onCategoryChange(e) {
      this.categoryIndex = parseInt(e.detail.value);
      this.pageParams.pageNum = 1;
      this.loadProducts();
    },
    
    onStatusChange(e) {
      this.statusIndex = parseInt(e.detail.value);
      this.pageParams.pageNum = 1;
      this.loadProducts();
    },
    
    // Ê∑ªÂä†Êñ∞‰∫ßÂìÅ
    handleAddProduct() {
      uni.navigateTo({
        url: '/pages/merchant/newshop?type=add'
      });
    },
    
    // ÁºñËæë‰∫ßÂìÅ
    handleEdit(product) {
      uni.navigateTo({
        url: `/pages/merchant/productupdate?type=edit&id=${product.id}`
      });
    },
    
    // Âà†Èô§‰∫ßÂìÅ
    async handleDelete(product) {
      if (this.actionLoading) return;
      
      uni.showModal({
        title: 'Á°ÆËÆ§Âà†Èô§',
        content: `Á°ÆÂÆöË¶ÅÂà†Èô§"${product.productName}"ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`,
        confirmColor: '#F56C6C',
        success: async (res) => {
          if (res.confirm) {
            await this.deleteProduct(product.id);
          }
        }
      });
    },
    
    async deleteProduct(id) {
      this.actionLoading = true;
      try {
        // Ê£ÄÊü•ÁΩëÁªúÁä∂ÊÄÅ
        await this.checkNetworkStatus();
        
        uni.showLoading({
          title: 'Âà†Èô§‰∏≠...',
          mask: true
        });
        
        console.log(`üóëÔ∏è ÂºÄÂßãÂà†Èô§ÂïÜÂìÅ ID: ${id}`);
        
        // Áõ¥Êé•‰º†ÈÄíÂçï‰∏™IDÊï∞Â≠ó
        const res = await productApi.delete(id);
        
        // Á°Æ‰øù hideLoading Âú®ËØ∑Ê±ÇÂÆåÊàêÂêéË∞ÉÁî®
        uni.hideLoading();
        
        console.log('‚úÖ Âà†Èô§Êé•Âè£ÂìçÂ∫î:', res);
        
        if (res.code === 200) {
          uni.showToast({
            title: 'Âà†Èô§ÊàêÂäü',
            icon: 'success',
            duration: 2000
          });
          // Âª∂Ëøü‰∏Ä‰∏ãÂÜçÂà∑Êñ∞ÂàóË°®ÔºåÁ°Æ‰øùÂà†Èô§Êìç‰ΩúÂÆåÊàê
          setTimeout(() => {
            this.pageParams.pageNum = 1;
            this.loadProducts();
          }, 500);
        } else {
          uni.showToast({
            title: res.msg || 'Âà†Èô§Â§±Ë¥•',
            icon: 'none',
            duration: 3000
          });
        }
      } catch (error) {
        console.error('üí• Âà†Èô§ÂïÜÂìÅÂ§±Ë¥•:', error);
        // Á°Æ‰øùÂú®ÈîôËØØÊÉÖÂÜµ‰∏ã‰πüË∞ÉÁî® hideLoading
        uni.hideLoading();
        uni.showToast({
          title: error.message || 'Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï',
          icon: 'none',
          duration: 3000
        });
      } finally {
        this.actionLoading = false;
      }
    },
    
    // ‰∏äÊû∂/‰∏ãÊû∂ÂïÜÂìÅ ('0':‰∏äÊû∂, '2':‰∏ãÊû∂)
    async toggleProductStatus(product) {
      if (this.actionLoading) return;
      
      try {
        const newStatus = product.status === '0' ? '2' : '0';
        const action = newStatus === '0' ? '‰∏äÊû∂' : '‰∏ãÊû∂';
        
        uni.showModal({
          title: 'Á°ÆËÆ§Êìç‰Ωú',
          content: `Á°ÆÂÆöË¶Å${action}ÂïÜÂìÅ"${product.productName}"ÂêóÔºü`,
          success: async (res) => {
            if (res.confirm) {
              await this.doUpdateStatusWithRetry(product, newStatus, action);
            }
          }
        });
      } catch (error) {
        console.error('Êõ¥Êñ∞ÂïÜÂìÅÁä∂ÊÄÅÂ§±Ë¥•:', error);
      }
    },
    
    // Â∏¶ÈáçËØïÊú∫Âà∂ÁöÑÁä∂ÊÄÅÊõ¥Êñ∞
    async doUpdateStatusWithRetry(product, newStatus, action, retries = 2) {
      for (let i = 0; i < retries; i++) {
        try {
          console.log(`üîÑ Á¨¨ ${i + 1} Ê¨°Â∞ùËØïÊõ¥Êñ∞Áä∂ÊÄÅ`);
          await this.doUpdateStatus(product, newStatus, action);
          return; // ÊàêÂäüÂàôÈÄÄÂá∫
        } catch (error) {
          console.warn(`‚ö†Ô∏è Á¨¨ ${i + 1} Ê¨°Â∞ùËØïÂ§±Ë¥•:`, error);
          if (i === retries - 1) {
            // ÊúÄÂêé‰∏ÄÊ¨°Â§±Ë¥•ÂàôÊäõÂá∫ÈîôËØØ
            throw error;
          }
          // Á≠âÂæÖ1ÁßíÂêéÈáçËØï
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      }
    },
    
    async doUpdateStatus(product, newStatus, action) {
      this.actionLoading = true;
      try {
        // Ê£ÄÊü•ÁΩëÁªúÁä∂ÊÄÅ
        await this.checkNetworkStatus();
        
        uni.showLoading({
          title: `${action}‰∏≠...`,
          mask: true
        });

        console.log(`üîÑ ÂºÄÂßãÊõ¥Êñ∞ÂïÜÂìÅÁä∂ÊÄÅ - ID: ${product.id}, Êñ∞Áä∂ÊÄÅ: ${newStatus}`);
        
        let res;
        
        try {
          // ‰ΩøÁî®Áä∂ÊÄÅÊõ¥Êñ∞Êé•Âè£
          console.log(`üì§ Ë∞ÉÁî®Áä∂ÊÄÅÊõ¥Êñ∞Êé•Âè£: PUT /product/spu/status?productSpuId=${product.id}&status=${newStatus}`);
          res = await productApi.updateStatus(product.id, newStatus);
          console.log('‚úÖ Áä∂ÊÄÅÊõ¥Êñ∞Êé•Âè£ÂìçÂ∫î:', res);
        } catch (apiError) {
          console.warn('‚ö†Ô∏è Áä∂ÊÄÅÊõ¥Êñ∞Êé•Âè£Â§±Ë¥•ÔºåÈîôËØØ‰ø°ÊÅØ:', apiError);
          
          // Â¶ÇÊûúÁä∂ÊÄÅÊõ¥Êñ∞Êé•Âè£Â§±Ë¥•Ôºå‰ΩøÁî®ÈÄöÁî®Êõ¥Êñ∞Êé•Âè£
          console.log('üîÑ Â∞ùËØï‰ΩøÁî®ÈÄöÁî®Êõ¥Êñ∞Êé•Âè£');
          const updateData = {
            productSpuId: product.id,
            productName: product.originalData?.productName || product.productName,
            productDetail: product.originalData?.productDetail || product.productDetail,
            category: product.originalData?.category || product.categoryName,
            productStatus: newStatus,
            marketPrice: this.getOriginalPrice(product.price),
            costPrice: product.originalData?.costPrice || 0,
            stock: product.originalData?.stock || product.stock,
            specType: product.originalData?.specType || '1',
            mainImage: product.originalData?.mainImage || product.image
          };
          
          console.log('üì§ ÈÄöÁî®Êõ¥Êñ∞Êé•Âè£ÂèÇÊï∞:', updateData);
          res = await productApi.update(updateData);
          console.log('‚úÖ ÈÄöÁî®Êõ¥Êñ∞Êé•Âè£ÂìçÂ∫î:', res);
        }

        uni.hideLoading();

        if (res.code === 200) {
          uni.showToast({
            title: `${action}ÊàêÂäü`,
            icon: 'success',
            duration: 2000
          });
          
          // Á´ãÂç≥Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ
          const productIndex = this.products.findIndex(p => p.id === product.id);
          if (productIndex !== -1) {
            this.products[productIndex].status = newStatus;
            // Âº∫Âà∂Êõ¥Êñ∞ËßÜÂõæ
            this.$forceUpdate();
          }
          
          console.log(`‚úÖ ÂïÜÂìÅÁä∂ÊÄÅÊõ¥Êñ∞ÊàêÂäüÔºåÊú¨Âú∞Áä∂ÊÄÅÂ∑≤ÂêåÊ≠•`);
        } else {
          console.error('‚ùå Êé•Âè£ËøîÂõûÈîôËØØ:', res);
          uni.showToast({
            title: res.msg || `${action}Â§±Ë¥•`,
            icon: 'none',
            duration: 3000
          });
          throw new Error(res.msg || `${action}Â§±Ë¥•`);
        }
      } catch (error) {
        console.error('üí• Êõ¥Êñ∞ÂïÜÂìÅÁä∂ÊÄÅÂ§±Ë¥•:', error);
        uni.hideLoading();
        uni.showToast({
          title: error.message || 'Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',
          icon: 'none',
          duration: 3000
        });
        throw error; // ÈáçÊñ∞ÊäõÂá∫ÈîôËØØ‰æõÈáçËØïÊú∫Âà∂‰ΩøÁî®
      } finally {
        this.actionLoading = false;
      }
    },
    
    // ËæÖÂä©ÊñπÊ≥ïÔºö‰ªéÊ†ºÂºèÂåñ‰ª∑Ê†º‰∏≠ÊèêÂèñÂéüÂßã‰ª∑Ê†º
    getOriginalPrice(formattedPrice) {
      if (!formattedPrice) return 0;
      // ÁßªÈô§ "Ôø•" Á¨¶Âè∑Âπ∂ËΩ¨Êç¢‰∏∫Êï∞Â≠ó
      const priceStr = formattedPrice.replace('Ôø•', '');
      return parseFloat(priceStr) || 0;
    },
    
    // ‰∏ãÊãâÂà∑Êñ∞
    handlePullDownRefresh() {
      this.refreshing = true;
      this.pageParams.pageNum = 1;
      this.loadProducts();
    },
    
    // ‰∏äÊãâÂä†ËΩΩÊõ¥Â§ö
    handleReachBottom() {
      if (this.loading || this.loadMoreStatus === 'noMore') {
        return;
      }
      
      this.loadMoreStatus = 'loading';
      this.pageParams.pageNum++;
      this.loadProducts();
    }
  },
  
  onLoad() {
    console.log('üöÄ ÂïÜÂìÅÁÆ°ÁêÜÈ°µÈù¢Âä†ËΩΩ');
    this.loadProducts();
  },
  
  onShow() {
    console.log('üîÑ ÂïÜÂìÅÁÆ°ÁêÜÈ°µÈù¢ÊòæÁ§∫ÔºåÂà∑Êñ∞Êï∞ÊçÆ');
    this.pageParams.pageNum = 1;
    this.loadProducts();
  },
  
  onPullDownRefresh() {
    console.log('‚¨áÔ∏è Ëß¶Âèë‰∏ãÊãâÂà∑Êñ∞');
    this.handlePullDownRefresh();
  },
  
  onReachBottom() {
    console.log('‚¨ÜÔ∏è Ëß¶Âèë‰∏äÊãâÂä†ËΩΩÊõ¥Â§ö');
    this.handleReachBottom();
  }
}
</script>

<style lang="scss" scoped>
.product-management {
  padding: 30rpx;
  background-color: #f5f7fa;
  min-height: 100vh;
}

.top-section {
  display: flex;
  flex-direction: column;
  gap: 20rpx;
  margin-bottom: 30rpx;
  
  .search-box {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 12rpx;
    padding: 20rpx 24rpx;
    border: 1rpx solid #e1e5eb;
    position: relative;
    
    .search-input {
      flex: 1;
      margin-left: 16rpx;
      font-size: 28rpx;
      height: 40rpx;
      line-height: 40rpx;
    }
    
    .clear-icon {
      margin-left: 16rpx;
    }
  }
  
  .add-btn {
    background: #409EFF;
    color: #fff;
    border: none;
    border-radius: 12rpx;
    padding: 24rpx;
    font-size: 28rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: auto;
    min-height: 88rpx;
    line-height: normal;
    
    &::after {
      border: none;
    }
  }
}

.filter-section {
  margin-bottom: 30rpx;
  
  .filter-group {
    display: flex;
    gap: 20rpx;
    
    .filter-picker {
      flex: 1;
      
      .filter-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        border-radius: 12rpx;
        padding: 20rpx 24rpx;
        border: 1rpx solid #e1e5eb;
        
        .filter-text {
          font-size: 26rpx;
          color: #333;
        }
      }
    }
  }
}

.loading-state {
  padding: 100rpx 0;
  text-align: center;
}

.product-grid {
  height: calc(100vh - 400rpx);
  
  .grid-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    
    .product-card {
      width: calc(50% - 10rpx);
      background: #fff;
      border-radius: 16rpx;
      margin-bottom: 20rpx;
      overflow: hidden;
      box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
      
      .product-image {
        width: 100%;
        height: 300rpx;
        position: relative;
        
        .image {
          width: 100%;
          height: 100%;
        }
        
        .status-badge {
          position: absolute;
          top: 16rpx;
          right: 16rpx;
          padding: 8rpx 16rpx;
          border-radius: 20rpx;
          font-size: 22rpx;
          font-weight: 500;
          
          &.status-on {
            background: rgba(64, 158, 255, 0.9);
            color: #fff;
          }
          
          &.status-off {
            background: rgba(153, 153, 153, 0.9);
            color: #fff;
          }
        }
      }
      
      .product-info {
        padding: 24rpx;
        
        .product-name {
          display: block;
          font-size: 30rpx;
          font-weight: 600;
          color: #303133;
          margin-bottom: 12rpx;
          line-height: 1.4;
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
        }
        
        .product-category {
          display: block;
          font-size: 24rpx;
          color: #909399;
          margin-bottom: 8rpx;
        }
        
        .product-detail {
          display: block;
          font-size: 24rpx;
          color: #606266;
          margin-bottom: 12rpx;
          line-height: 1.4;
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
        }
        
        .product-price {
          display: block;
          font-size: 28rpx;
          color: #F56C6C;
          font-weight: 600;
          margin-bottom: 8rpx;
        }
        
        .product-stock {
          display: block;
          font-size: 24rpx;
          color: #909399;
        }
      }
      
      .action-buttons {
        display: flex;
        justify-content: space-between;
        padding: 20rpx 24rpx;
        border-top: 1rpx solid #f0f0f0;
        
        button {
          background: none;
          border: none;
          padding: 12rpx 0;
          font-size: 24rpx;
          display: flex;
          align-items: center;
          flex: 1;
          justify-content: center;
          border-radius: 8rpx;
          margin: 0 4rpx;
          transition: all 0.3s;
          
          &::after {
            border: none;
          }
          
          &:disabled {
            opacity: 0.5;
          }
        }
        
        .status-btn {
          color: #E6A23C;
          background: #fdf6ec;
        }
        
        .edit-btn {
          color: #409EFF;
          background: #f0f9ff;
        }
        
        .delete-btn {
          color: #F56C6C;
          background: #fef0f0;
        }
      }
    }
  }
  
  .load-more {
    padding: 30rpx 0;
  }
  
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 120rpx 0;
    
    .empty-image {
      width: 200rpx;
      height: 200rpx;
      margin-bottom: 30rpx;
      opacity: 0.6;
    }
    
    .empty-text {
      margin-bottom: 40rpx;
      font-size: 28rpx;
      color: #909399;
    }
    
    .empty-btn {
      background: #409EFF;
      color: #fff;
      border: none;
      border-radius: 12rpx;
      padding: 20rpx 40rpx;
      font-size: 28rpx;
      
      &::after {
        border: none;
      }
    }
  }
}
</style>